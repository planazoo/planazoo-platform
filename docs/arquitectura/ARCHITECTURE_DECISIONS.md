# üèóÔ∏è Decisiones Arquitect√≥nicas - Planazoo

**Fecha de creaci√≥n:** Diciembre 2024  
**Versi√≥n:** 1.0  
**Estado:** Finalizado

---

## üìã √çndice

1. [Resumen Ejecutivo](#resumen-ejecutivo)
2. [Filosof√≠a General](#filosof√≠a-general)
3. [Decisiones Arquitect√≥nicas](#decisiones-arquitect√≥nicas)
4. [Implementaci√≥n](#implementaci√≥n)
5. [Ejemplos Pr√°cticos](#ejemplos-pr√°cticos)
6. [Consideraciones Futuras](#consideraciones-futuras)
7. [Referencias](#referencias)

---

## üéØ Resumen Ejecutivo

### Filosof√≠a Principal
**"Offline First + Sincronizaci√≥n Inteligente + Permisos Granulares"**

La aplicaci√≥n est√° dise√±ada para funcionar completamente sin conexi√≥n, con sincronizaci√≥n autom√°tica cuando es posible, y un sistema de permisos que permite colaboraci√≥n flexible pero controlada.

### Beneficios Clave
- ‚úÖ **Funciona siempre** (offline first)
- ‚úÖ **Colabora inteligentemente** (permisos granulares)
- ‚úÖ **Sincroniza autom√°ticamente** (tiempo real + conflictos)
- ‚úÖ **Escala eficientemente** (optimizaci√≥n autom√°tica)
- ‚úÖ **Desarrolla r√°pidamente** (simplicidad inicial)

---

## üß† Filosof√≠a General

### Principios de Dise√±o

#### 1. **Offline First**
La aplicaci√≥n debe funcionar perfectamente sin conexi√≥n a internet. La sincronizaci√≥n es un bonus, no un requisito.

#### 2. **Simplicidad Inicial**
Complejidad arquitect√≥nica m√≠nima en el MVP para permitir desarrollo r√°pido e iteraci√≥n.

#### 3. **Escalabilidad Futura**
Arquitectura preparada para optimizaciones autom√°ticas cuando sea necesario.

#### 4. **Colaboraci√≥n Controlada**
Sistema de permisos que permite flexibilidad sin perder control.

#### 5. **Experiencia Consistente**
UI y UX coherentes independientemente del estado de conexi√≥n.

---

## üèóÔ∏è Decisiones Arquitect√≥nicas

### 1. üóÉÔ∏è Gesti√≥n de Datos: Duplicaci√≥n Total + Optimizaci√≥n Futura

#### **Decisi√≥n**
Todos los eventos duplicados por participante en el MVP, con optimizaci√≥n autom√°tica al cerrar el plan.

#### **Justificaci√≥n**
- **Simplicidad:** Evita complejidad de sincronizaci√≥n de referencias
- **Desarrollo r√°pido:** Menos bugs y m√°s iteraci√≥n
- **Flexibilidad:** Cada participante puede personalizar su informaci√≥n
- **Optimizaci√≥n futura:** Conversi√≥n autom√°tica a referencias cuando sea beneficioso

#### **Implementaci√≥n**
```dart
// Cada participante tiene su copia completa del evento
Event vueloPadre = Event(
  id: "vuelo_123_padre",
  participantId: "padre",
  description: "Vuelo Barcelona-Londres",
  hour: 7,
  asiento: "12A",
  gate: "B15",
);

Event vueloMadre = Event(
  id: "vuelo_123_madre",
  participantId: "madre", 
  description: "Vuelo Barcelona-Londres",
  hour: 7,
  asiento: "12B",
  gate: "B15",
);
```

#### **Optimizaci√≥n Futura**
Al cerrar el plan, eventos id√©nticos se convierten autom√°ticamente a referencias para ahorrar espacio.

---

### 2. üîÑ Sincronizaci√≥n: Estrategia H√≠brida

#### **Decisi√≥n**
Combinaci√≥n de Firestore Transactions + Optimistic Updates seg√∫n el tipo de operaci√≥n.

#### **Justificaci√≥n**
- **Consistencia:** Transactions garantizan operaciones cr√≠ticas
- **UX r√°pida:** Optimistic updates para cambios cosm√©ticos
- **Balance:** Lo mejor de ambos mundos

#### **Criterios de Aplicaci√≥n**

| Operaci√≥n | Estrategia | Raz√≥n |
|-----------|------------|-------|
| **Cambiar hora/duraci√≥n** | Transaction | Cr√≠tico para m√∫ltiples participantes |
| **A√±adir/quitar participante** | Transaction | Cambia referencias de m√∫ltiples lugares |
| **Cambiar descripci√≥n** | Optimistic | Solo afecta texto, no l√≥gica |
| **Cambiar color** | Optimistic | Cosm√©tico, no cr√≠tico |
| **Crear evento nuevo** | Optimistic | No hay referencias existentes que romper |
| **Borrar evento** | Transaction | Elimina referencias de m√∫ltiples participantes |

---

### 3. üåç Timezones: Sistema UTC del Plan

#### **Decisi√≥n**
Todos los eventos se guardan en timezone base del plan, con conversi√≥n autom√°tica por participante.

#### **Justificaci√≥n**
- **Simplicidad m√°xima:** Como sistema de vuelos (no hay decisiones dif√≠ciles)
- **Consistencia:** Todos los eventos en la misma "moneda temporal"
- **Escalabilidad:** Funciona autom√°ticamente para cualquier timezone

#### **Implementaci√≥n**
```dart
class Plan {
  String id;
  String name;
  String baseTimezone; // ‚Üê Nuestro "UTC" del plan
  List<Participant> participants;
}

class Event {
  String id;
  String description;
  DateTime date; // ‚Üê En timezone base del plan
  int hour;      // ‚Üê En timezone base del plan
  // Sin campo timezone espec√≠fico
}

// Conversi√≥n autom√°tica al mostrar
String formatTimeForParticipant(Event event, Participant participant) {
  final utcTime = DateTime.utc(event.date.year, event.date.month, event.date.day, event.hour);
  final localTime = utcTime.toLocal(participant.timezone);
  return '${localTime.hour.toString().padLeft(2, '0')}:${localTime.minute.toString().padLeft(2, '0')}';
}
```

---

### 4. üì± Arquitectura de Eventos: Parte Com√∫n + Parte Personal

#### **Decisi√≥n**
Separaci√≥n clara entre informaci√≥n compartida (parte com√∫n) e informaci√≥n individual (parte personal).

#### **Justificaci√≥n**
- **Separaci√≥n de responsabilidades:** Creador controla lo com√∫n, participante controla lo personal
- **Flexibilidad total:** Cualquier nivel de personalizaci√≥n
- **Colaboraci√≥n natural:** Admins pueden gestionar informaci√≥n de otros cuando es necesario

#### **Estructura**
```dart
class Event {
  String id;
  String createdBy; // ‚Üê Qui√©n puede editar parte com√∫n
  
  // Parte com√∫n (editada por creador)
  String description;
  DateTime date;
  int hour;
  int startMinute;
  int durationMinutes;
  String location;
  String notes;
  List<String> participantIds;
  
  // Parte personal (editada por participante + admins)
  Map<String, Map<String, dynamic>> personalDetails;
  // Estructura: {"padre": {"asiento": "12A", "gate": "B15"}}
}
```

#### **Permisos**
- **Creador:** Edita parte com√∫n + su parte personal
- **Participante:** Edita solo su parte personal
- **Admin:** Edita parte com√∫n + cualquier parte personal

---

### 5. üîî Notificaciones: Sistema Push Completo

#### **Decisi√≥n**
Notificaciones push para todos los cambios importantes con configuraci√≥n personalizable.

#### **Justificaci√≥n**
- **Transparencia:** Usuarios siempre informados de cambios relevantes
- **Colaboraci√≥n:** Facilita trabajo en equipo
- **Flexibilidad:** Cada usuario puede configurar sus preferencias

#### **Tipos de Notificaciones**
- **Cambios en eventos existentes:** Hora, duraci√≥n, descripci√≥n
- **Nuevos eventos:** Cuando se crea un evento
- **Eventos eliminados:** Cuando se borra un evento
- **Cambios de participantes:** A√±adir/quitar participantes

#### **Configuraci√≥n**
```dart
class NotificationSettings {
  String userId;
  bool eventCreated;
  bool eventUpdated;
  bool eventDeleted;
  bool participantChanges;
  bool onlyMyEvents; // Solo eventos en los que participo
  bool onlyImportantChanges; // Solo cambios cr√≠ticos (hora, fecha)
}
```

---

### 6. ‚ö° Sincronizaci√≥n en Tiempo Real: Firestore + Riverpod

#### **Decisi√≥n**
Firestore real-time listeners + Riverpod state management para actualizaciones autom√°ticas.

#### **Justificaci√≥n**
- **Tiempo real:** Cambios instant√°neos entre usuarios
- **Reactivo:** UI se actualiza autom√°ticamente
- **Eficiente:** Solo escucha cambios relevantes

#### **Implementaci√≥n**
```dart
class EventSyncService {
  void startListening(String planId, String userId) {
    FirebaseFirestore.instance
        .collection('plans')
        .doc(planId)
        .collection('events')
        .where('participantIds', arrayContains: userId)
        .snapshots()
        .listen((snapshot) {
          _handleEventChanges(snapshot);
        });
  }
  
  void _handleEventChanges(QuerySnapshot snapshot) {
    for (final change in snapshot.docChanges) {
      switch (change.type) {
        case DocumentChangeType.added:
          eventNotifier.addEvent(Event.fromMap(change.doc.data()));
          break;
        case DocumentChangeType.modified:
          eventNotifier.updateEvent(Event.fromMap(change.doc.data()));
          break;
        case DocumentChangeType.removed:
          eventNotifier.removeEvent(change.doc.id);
          break;
      }
    }
  }
}
```

---

### 7. üì± Offline First: Funcionamiento Completo Sin Conexi√≥n

#### **Decisi√≥n**
Almacenamiento local completo + sincronizaci√≥n autom√°tica cuando hay conexi√≥n.

#### **Justificaci√≥n**
- **Confiabilidad:** App siempre funcional
- **Experiencia consistente:** Sin interrupciones por problemas de red
- **Productividad:** Usuarios pueden trabajar sin limitaciones

#### **Componentes**
```dart
// Base de datos local
class LocalDatabase {
  Future<void> saveEvent(Event event) async {
    await localDB.insert('events', event.toMap(), 
        conflictAlgorithm: ConflictAlgorithm.replace);
  }
  
  Future<List<Event>> getEventsForParticipant(String participantId) async {
    return await localDB.query('events', 
        where: 'participant_id = ?', whereArgs: [participantId]);
  }
}

// Cola de sincronizaci√≥n
class SyncQueue {
  List<SyncOperation> pendingOperations = [];
  
  void addOperation(SyncOperation operation) {
    pendingOperations.add(operation);
    _processQueue();
  }
  
  Future<void> _processQueue() async {
    if (!_isOnline()) return;
    
    for (final operation in pendingOperations) {
      try {
        await _executeOperation(operation);
        pendingOperations.remove(operation);
      } catch (e) {
        _scheduleRetry(operation);
      }
    }
  }
}
```

#### **Resoluci√≥n de Conflictos**
- **Estrategia:** √öltimo cambio gana (basado en timestamp)
- **Notificaci√≥n:** Usuario informado de conflictos resueltos
- **Log:** Historial de conflictos para debugging

---

### 8. üîê Permisos: Sistema H√≠brido de Roles

#### **Decisi√≥n**
3 roles base + permisos espec√≠ficos por evento para m√°xima flexibilidad.

#### **Justificaci√≥n**
- **Simplicidad:** Roles claros y comprensibles
- **Flexibilidad:** Permisos espec√≠ficos para casos especiales
- **Escalabilidad:** F√°cil a√±adir nuevos permisos si es necesario

#### **Roles Base**
```dart
enum UserRole {
  admin,        // üëë Admin del plan - todos los permisos
  participant,  // üë• Participante normal - permisos b√°sicos
  observer,     // üëÅÔ∏è Solo lectura - sin permisos de edici√≥n
}
```

#### **Matriz de Permisos**

| Acci√≥n | Admin | Creador | Participante | Observador |
|--------|-------|---------|--------------|------------|
| **Ver parte com√∫n** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **Editar parte com√∫n** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **Ver parte personal** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **Editar propia parte personal** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **Editar otras partes personales** | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **Crear eventos** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **Eliminar eventos** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |

#### **Implementaci√≥n**
```dart
class PermissionService {
  Future<bool> canEditEventCommon(String userId, String eventId) async {
    final event = await eventService.getEvent(eventId);
    final userRole = await getUserRole(userId, event.planId);
    
    // Admin puede editar cualquier parte com√∫n
    if (userRole == UserRole.admin) return true;
    
    // Creador puede editar su evento
    if (event.createdBy == userId) return true;
    
    return false;
  }
}
```

---

## üõ†Ô∏è Implementaci√≥n

### Tareas Creadas

#### **Sistema de Tracks y Multi-Participante (T68-T77)** ‚≠ê CORE
- **T68:** Modelo ParticipantTrack
- **T69:** CalendarScreen modo multi-track
- **T70:** Eventos multi-track (span horizontal)
- **T71:** Filtros de vista (Todos/Individual/Personalizado)
- **T72:** Control de d√≠as visibles
- **T73:** Gesti√≥n de orden de tracks
- **T74:** Modelo Event - Parte com√∫n + personal
- **T75:** EventDialog - UI parte com√∫n vs personal
- **T76:** Sincronizaci√≥n parte com√∫n
- **T77:** Indicadores visuales de permisos

#### **Vistas Filtradas y Timezone (T78-T82)**
- **T78:** Vista "Mi Agenda"
- **T79:** Vista "Plan Completo"
- **T80:** Vista "Personalizada"
- **T81:** Conversi√≥n timezone por participante
- **T82:** Indicador visual timezone

#### **Funcionalidades Avanzadas (T83-T90)**
- **T83:** Sistema de grupos de participantes
- **T84:** Propagaci√≥n autom√°tica de cambios
- **T85:** Notificaciones cambios compartidos
- **T86:** Sistema adaptativo d√≠as visibles
- **T87:** Scroll horizontal condicional
- **T88:** Redise√±o capas calendario
- **T89:** Indicadores eventos multi-participante
- **T90:** Resaltado track activo

#### **Offline First (T56-T62)**
- **T56:** Implementar Base de Datos Local
- **T57:** Implementar Cola de Sincronizaci√≥n
- **T58:** Implementar Resoluci√≥n de Conflictos
- **T59:** Implementar Indicadores de Estado Offline
- **T60:** Implementar Sincronizaci√≥n en Tiempo Real
- **T61:** Implementar Notificaciones Push Offline
- **T62:** Testing Exhaustivo Offline First

#### **Permisos Granulares (T63-T67)**
- **T63:** Implementar Modelo de Permisos y Roles
- **T64:** Implementar UI Condicional Basada en Permisos
- **T65:** Implementar Gesti√≥n de Admins del Plan
- **T66:** Implementar Transferencia de Propiedad de Eventos
- **T67:** Implementar Sistema de Observadores

### Orden de Implementaci√≥n

#### **Fase 1: Sistema de Tracks (CORE - Visual)**
1. **T68:** Modelo ParticipantTrack
2. **T69:** CalendarScreen modo multi-track
3. **T70:** Eventos multi-track (span)
4. **T71:** Filtros de vista
5. **T72:** Control de d√≠as visibles
6. **T74:** Modelo Event - Parte com√∫n + personal
7. **T75:** EventDialog - UI separada

#### **Fase 2: Sincronizaci√≥n y Permisos (Funcionalidad)**
8. **T76:** Sincronizaci√≥n parte com√∫n
9. **T77:** Indicadores visuales permisos
10. **T63:** Modelo de Permisos y Roles
11. **T64:** UI Condicional Basada en Permisos

#### **Fase 3: Offline First (Infraestructura)**
12. **T56:** Base de Datos Local
13. **T57:** Cola de Sincronizaci√≥n
14. **T60:** Sincronizaci√≥n en Tiempo Real
15. **T58:** Resoluci√≥n de Conflictos
16. **T59:** Indicadores de Estado Offline

#### **Fase 4: Vistas y Timezone (Refinamiento)**
17. **T78:** Vista "Mi Agenda"
18. **T79:** Vista "Plan Completo"
19. **T80:** Vista "Personalizada"
20. **T81:** Conversi√≥n timezone por participante
21. **T82:** Indicador visual timezone

#### **Fase 5: Funcionalidades Avanzadas (Optimizaci√≥n)**
22. **T73:** Gesti√≥n de orden de tracks
23. **T84:** Propagaci√≥n autom√°tica optimizada
24. **T85:** Notificaciones cambios compartidos
25. **T65:** Gesti√≥n de Admins del Plan
26. **T66:** Transferencia de Propiedad
27. **T67:** Sistema de Observadores
28. **T61:** Notificaciones Push Offline
29. **T62:** Testing Exhaustivo

#### **Fase 6: Funcionalidades Futuras (Opcional)**
30. **T83:** Sistema de grupos de participantes
31. **T86:** Sistema adaptativo d√≠as visibles
32. **T87:** Scroll horizontal condicional
33. **T88:** Redise√±o capas calendario
34. **T89:** Indicadores eventos multi-participante
35. **T90:** Resaltado track activo

---

## üí° Ejemplos Pr√°cticos

### Escenario 1: Familia Viajando

#### **Contexto**
Plan "Vacaciones Europa" con 4 participantes: Padre (Admin), Madre, Hijo1, Hijo2

#### **Evento: Vuelo Barcelona-Londres**
```
üìã PARTE COM√öN (Editada por Padre - Admin):
‚îú‚îÄ‚îÄ Descripci√≥n: "Vuelo Barcelona-Londres"
‚îú‚îÄ‚îÄ Hora: 07:00 (timezone base del plan)
‚îú‚îÄ‚îÄ Duraci√≥n: 2h 30m
‚îú‚îÄ‚îÄ Aerol√≠nea: "Iberia"
‚îî‚îÄ‚îÄ Participantes: Padre, Madre, Hijo1

üë§ PARTE PERSONAL (Editada por cada uno):
‚îú‚îÄ‚îÄ Padre: Asiento 12A, Gate B15, ‚úÖ Tarjeta obtenida
‚îú‚îÄ‚îÄ Madre: Asiento 12B, Gate B15, ‚ùå Tarjeta pendiente
‚îú‚îÄ‚îÄ Hijo1: Asiento 12C, Gate B15, ‚ùå Tarjeta pendiente
‚îî‚îÄ‚îÄ Hijo2: No participa (va en tren)
```

#### **Permisos en Acci√≥n**
- **Padre (Admin):** Puede editar todo (parte com√∫n + todas las partes personales)
- **Madre:** Puede editar solo su parte personal (asiento, gate, tarjeta)
- **Hijo1:** Puede editar solo su parte personal
- **Hijo2:** Solo ve el evento (no participa)

### Escenario 2: Equipo Remoto

#### **Contexto**
Plan "Proyecto Internacional" con 3 participantes: Dev (Madrid), PM (Nueva York), QA (Tokio)

#### **Evento: Daily Standup**
```
üìã PARTE COM√öN (Editada por Dev - Creador):
‚îú‚îÄ‚îÄ Descripci√≥n: "Daily Standup"
‚îú‚îÄ‚îÄ Hora: 09:00 (timezone base del plan - Madrid)
‚îú‚îÄ‚îÄ Duraci√≥n: 30m
‚îú‚îÄ‚îÄ Plataforma: "Zoom"
‚îî‚îÄ‚îÄ Participantes: Dev, PM, QA

üë§ CONVERSI√ìN AUTOM√ÅTICA POR TIMEZONE:
‚îú‚îÄ‚îÄ Dev (Madrid): 09:00
‚îú‚îÄ‚îÄ PM (Nueva York): 03:00 (conversi√≥n autom√°tica)
‚îî‚îÄ‚îÄ QA (Tokio): 17:00 (conversi√≥n autom√°tica)
```

### Escenario 3: Sistema de Tracks Multi-Participante

#### **Contexto**
Plan "Vacaciones Familia" con 4 participantes: Padre (Admin), Madre, Hijo, Hija

#### **Vista Plan Completo (Organizador)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇHoras‚îÇ  Padre  ‚îÇ  Madre  ‚îÇ  Hijo   ‚îÇ  Hija   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ07:00‚îÇ ‚úàÔ∏è Vuelo Barcelona - Londres (todos)‚îÄ‚îÄ‚î§
‚îÇ     ‚îÇ Asiento ‚îÇ Asiento ‚îÇ Asiento ‚îÇ Asiento ‚îÇ
‚îÇ     ‚îÇ   12A   ‚îÇ   12B   ‚îÇ   12C   ‚îÇ   12D   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ10:00‚îÇ         ‚îÇ üõçÔ∏è Compr‚îÇ         ‚îÇ üõçÔ∏è Compr‚îÇ
‚îÇ     ‚îÇ         ‚îÇ (Madre + Hija)    ‚îÇ         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ14:00‚îÇ ‚öΩ F√∫tbol‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ         ‚îÇ         ‚îÇ
‚îÇ     ‚îÇ (Padre + Hijo)  ‚îÇ         ‚îÇ         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **Vista "Mi Agenda" (Madre)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇHoras‚îÇ  Mi Agenda - Madre        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ07:00‚îÇ ‚úàÔ∏è Vuelo BCN-LON          ‚îÇ
‚îÇ     ‚îÇ Asiento: 12B              ‚îÇ
‚îÇ     ‚îÇ Gate: B15                 ‚îÇ
‚îÇ     ‚îÇ ‚úÖ Tarjeta obtenida       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ10:00‚îÇ üõçÔ∏è Compras con Hija       ‚îÇ
‚îÇ     ‚îÇ Notas: Zara, H&M          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **Permisos en Acci√≥n (Vuelo)**
- **Padre (Admin):** Edita hora del vuelo (parte com√∫n) + su asiento (parte personal) + puede editar asientos de todos
- **Madre:** Solo edita su asiento y preferencias (parte personal), ve hora del vuelo en readonly
- **Hijo/Hija:** Solo editan sus partes personales

### Escenario 4: Offline First en Acci√≥n

#### **Contexto**
Usuario en avi√≥n sin conexi√≥n a internet

#### **Flujo de Trabajo**
```
1. Usuario abre app ‚Üí Carga datos desde base de datos local
2. Usuario crea evento ‚Üí Se guarda localmente inmediatamente
3. Usuario edita evento ‚Üí Cambios locales instant√°neos
4. Usuario elimina evento ‚Üí Eliminaci√≥n local inmediata
5. Usuario aterriza ‚Üí Sincronizaci√≥n autom√°tica al reconectar
6. Cambios se propagan ‚Üí Otros usuarios reciben notificaciones
```

---

## üöÄ Consideraciones Futuras

### Optimizaciones Planificadas

#### **1. Optimizaci√≥n Autom√°tica de Datos**
- **Cu√°ndo:** Al cerrar un plan
- **Qu√©:** Convertir eventos id√©nticos a referencias
- **Beneficio:** Reducci√≥n de 40-60% en espacio de almacenamiento

#### **2. Sincronizaci√≥n Inteligente**
- **Debouncing:** Agrupar cambios r√°pidos
- **Compresi√≥n:** Comprimir datos para sincronizaci√≥n
- **Incremental:** Solo sincronizar cambios desde √∫ltima conexi√≥n

#### **3. Permisos Avanzados**
- **Permisos temporales:** Admin por tiempo limitado
- **Permisos por tipo de evento:** Diferentes reglas para vuelos vs reuniones
- **Permisos delegados:** Transferir permisos temporalmente

### Escalabilidad

#### **Planes Grandes**
- **Lazy loading:** Cargar eventos por chunks
- **√çndices optimizados:** Para b√∫squedas r√°pidas
- **Cache inteligente:** Mantener eventos frecuentes en memoria

#### **Muchos Participantes**
- **Filtrado eficiente:** Solo mostrar eventos relevantes
- **Agrupaci√≥n:** Agrupar participantes similares
- **Vistas personalizadas:** Cada usuario ve solo lo relevante

### Nuevas Funcionalidades

#### **1. Eventos Recurrentes**
- **Base:** Eventos que se repiten autom√°ticamente
- **Personalizaci√≥n:** Cada instancia puede tener informaci√≥n personal diferente
- **Gesti√≥n:** Editar serie completa vs instancia individual

#### **2. Integraci√≥n con Calendarios Externos**
- **Sincronizaci√≥n:** Con Google Calendar, Outlook, etc.
- **Bidireccional:** Cambios en ambos sentidos
- **Filtros:** Solo sincronizar ciertos tipos de eventos

#### **3. Analytics y Reportes**
- **Estad√≠sticas:** Tiempo dedicado a diferentes actividades
- **Reportes:** Res√∫menes de planes y gastos
- **Insights:** Sugerencias basadas en patrones

---

## üìö Referencias

### Documentos Relacionados
- `docs/tareas/TASKS.md` - Lista completa de tareas de implementaci√≥n
- `docs/tareas/COMPLETED_TASKS.md` - Historial de tareas completadas
- `docs/especificaciones/CALENDAR_CAPABILITIES.md` - Capacidades funcionales del calendario
- `docs/especificaciones/FRANKENSTEIN_PLAN_SPEC.md` - Especificaci√≥n del plan de testing

### Decisiones T√©cnicas
- **Riverpod:** State management elegido para la aplicaci√≥n
- **Firestore:** Base de datos en la nube para sincronizaci√≥n
- **SQLite/Hive:** Base de datos local para funcionamiento offline
- **Flutter:** Framework de desarrollo principal

### Patrones de Dise√±o
- **Offline First:** Patr√≥n de dise√±o principal
- **Repository Pattern:** Para abstracci√≥n de datos
- **Observer Pattern:** Para notificaciones y sincronizaci√≥n
- **Strategy Pattern:** Para diferentes tipos de sincronizaci√≥n

---

## üìù Historial de Cambios

| Fecha | Versi√≥n | Cambios |
|-------|---------|---------|
| Dic 2024 | 1.0 | Documento inicial con todas las decisiones arquitect√≥nicas |

---

**Documento creado:** Diciembre 2024  
**√öltima actualizaci√≥n:** 9 de octubre de 2025  
**Pr√≥xima revisi√≥n:** Al completar implementaci√≥n de T56-T67

---

## üÜï **Actualizaciones Recientes (Octubre 2025)**

### **T93-T95: Mejoras de Alojamientos y Optimizaci√≥n**
- **T93:** Iconos visuales de check-in/check-out en alojamientos multi-d√≠a
- **T94:** Optimizaci√≥n y limpieza de c√≥digo en CalendarScreen
- **T95:** Arreglo de interacci√≥n de tap en fila de alojamientos

### **Estado Actual del Sistema**
- ‚úÖ **Alojamientos:** Sistema completo con iconos visuales y interacciones funcionales
- ‚úÖ **Eventos:** Drag & drop, edici√≥n y creaci√≥n completamente operativos
- ‚úÖ **C√≥digo:** Optimizado con constantes y funciones helper
- ‚úÖ **UI/UX:** Interacciones intuitivas y responsivas

### **Pr√≥ximos Pasos**
- Implementar sistema de tracks multi-participante (T68-T77)
- A√±adir funcionalidades de timezone (T40-T45)
- Desarrollar sistema offline first (T56-T62)
